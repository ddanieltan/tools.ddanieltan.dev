name: Update Index

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Need full history for git log dates

      - name: Install uv
        uses: astral-sh/setup-uv@v5

      - name: Run generation script
        run: uv run build_index.py

      - name: Deploy to Branch
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          publish_branch: deploy
          keep_files: true # Keep existing files that might not be in the checkout if needed, though usually false is safer for pure builds. True is safer here to avoid deleting .git folder if something goes wrong, but actually for this action, it copies to a temp dir.
          # We want to publish the ROOT directory '.' 
          # The action automatically handles cleaning the destination branch content.